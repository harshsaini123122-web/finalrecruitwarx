<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Resume - RecruitWarX Portal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #31485d;
            --secondary-color: #3289c3;
            --light-bg: #f8f9fa;
            --dark-text: #2c3e50;
        }

        body {
            background-color: var(--light-bg);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .navbar {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .navbar-brand, .nav-link {
            color: white !important;
            font-weight: 500;
        }

        .nav-link:hover {
            color: #ecf0f1 !important;
        }

        .dashboard-header {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }

        .card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.06);
            margin-bottom: 2rem;
        }

        .card-header {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 12px 12px 0 0 !important;
            padding: 1.25rem 1.5rem;
            border: none;
        }

        .btn-primary {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 500;
        }

        .btn-primary:hover {
            background: linear-gradient(to right, var(--secondary-color), var(--primary-color));
        }

        .form-control, .form-select {
            border-radius: 8px;
            border: 2px solid #e9ecef;
            padding: 12px;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 0.2rem rgba(50, 137, 195, 0.25);
        }

        .resume-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.06);
        }

        .section-title {
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--secondary-color);
        }

        .experience-item, .education-item {
            border-left: 3px solid var(--secondary-color);
            padding-left: 1rem;
            margin-bottom: 1.5rem;
        }

        .skill-tag {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.85rem;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
            display: inline-block;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="candidate-dashboard.html"><i class="fas fa-briefcase me-2"></i>RecruitWarX</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="jobs.html"><i class="fas fa-search me-1"></i>Find Jobs</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="applications.html"><i class="fas fa-paper-plane me-1"></i>My Applications</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="profile.html"><i class="fas fa-user me-1"></i>Profile</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="resume.html"><i class="fas fa-file-alt me-1"></i>Resume</a>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user-circle me-1"></i><span id="navUserName">Loading...</span>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="profile.html"><i class="fas fa-user me-2"></i>Profile</a></li>
                            <li><a class="dropdown-item" href="#"><i class="fas fa-cog me-2"></i>Settings</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="handlers/logout.php"><i class="fas fa-sign-out-alt me-2"></i>Logout</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="dashboard-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="dashboard-title">My Resume</h1>
                    <p class="dashboard-subtitle">Create and manage your professional resume</p>
                </div>
                <div class="col-md-4 text-end">
                    <button class="btn btn-light" id="saveResumeBtn">
                        <i class="fas fa-save me-2"></i>Save Resume
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <form id="resumeForm">
            <input type="hidden" name="action" value="save_resume">
            
            <!-- Professional Summary -->
            <div class="resume-section">
                <h3 class="section-title"><i class="fas fa-user me-2"></i>Professional Summary</h3>
                <div class="mb-3">
                    <textarea class="form-control" name="summary" id="summary" rows="4" 
                              placeholder="Write a brief professional summary highlighting your key skills and experience..."></textarea>
                </div>
            </div>

            <!-- Work Experience -->
            <div class="resume-section">
                <h3 class="section-title"><i class="fas fa-briefcase me-2"></i>Work Experience</h3>
                <div id="experienceContainer">
                    <div class="experience-item">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Job Title</label>
                                <input type="text" class="form-control" name="job_title[]" placeholder="e.g. Software Engineer">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Company</label>
                                <input type="text" class="form-control" name="company[]" placeholder="e.g. Tech Company">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Start Date</label>
                                <input type="month" class="form-control" name="start_date[]">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">End Date</label>
                                <input type="month" class="form-control" name="end_date[]">
                                <div class="form-check mt-2">
                                    <input class="form-check-input" type="checkbox" name="current_job[]">
                                    <label class="form-check-label">Currently working here</label>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Job Description</label>
                            <textarea class="form-control" name="job_description[]" rows="3" 
                                      placeholder="Describe your responsibilities and achievements..."></textarea>
                        </div>
                    </div>
                </div>
                <button type="button" class="btn btn-outline-primary" id="addExperienceBtn">
                    <i class="fas fa-plus me-2"></i>Add Experience
                </button>
            </div>

            <!-- Education -->
            <div class="resume-section">
                <h3 class="section-title"><i class="fas fa-graduation-cap me-2"></i>Education</h3>
                <div id="educationContainer">
                    <div class="education-item">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Degree</label>
                                <input type="text" class="form-control" name="degree[]" placeholder="e.g. Bachelor of Technology">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Institution</label>
                                <input type="text" class="form-control" name="institution[]" placeholder="e.g. University Name">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Year of Graduation</label>
                                <input type="number" class="form-control" name="graduation_year[]" min="1990" max="2030">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Grade/CGPA</label>
                                <input type="text" class="form-control" name="grade[]" placeholder="e.g. 8.5 CGPA">
                            </div>
                        </div>
                    </div>
                </div>
                <button type="button" class="btn btn-outline-primary" id="addEducationBtn">
                    <i class="fas fa-plus me-2"></i>Add Education
                </button>
            </div>

            <!-- Skills -->
            <div class="resume-section">
                <h3 class="section-title"><i class="fas fa-code me-2"></i>Skills</h3>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Technical Skills</label>
                        <textarea class="form-control" name="technical_skills" rows="3" 
                                  placeholder="e.g. JavaScript, Python, React, Node.js (separate with commas)"></textarea>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Soft Skills</label>
                        <textarea class="form-control" name="soft_skills" rows="3" 
                                  placeholder="e.g. Leadership, Communication, Problem Solving (separate with commas)"></textarea>
                    </div>
                </div>
            </div>

            <!-- Projects -->
            <div class="resume-section">
                <h3 class="section-title"><i class="fas fa-project-diagram me-2"></i>Projects</h3>
                <div id="projectsContainer">
                    <div class="project-item">
                        <div class="row">
                            <div class="col-md-8 mb-3">
                                <label class="form-label">Project Name</label>
                                <input type="text" class="form-control" name="project_name[]" placeholder="e.g. E-commerce Website">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Project URL</label>
                                <input type="url" class="form-control" name="project_url[]" placeholder="https://...">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Project Description</label>
                            <textarea class="form-control" name="project_description[]" rows="2" 
                                      placeholder="Describe the project and technologies used..."></textarea>
                        </div>
                    </div>
                </div>
                <button type="button" class="btn btn-outline-primary" id="addProjectBtn">
                    <i class="fas fa-plus me-2"></i>Add Project
                </button>
            </div>

            <!-- Certifications -->
            <div class="resume-section">
                <h3 class="section-title"><i class="fas fa-certificate me-2"></i>Certifications</h3>
                <div id="certificationsContainer">
                    <div class="certification-item">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Certification Name</label>
                                <input type="text" class="form-control" name="certification_name[]" placeholder="e.g. AWS Certified Developer">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Issuing Organization</label>
                                <input type="text" class="form-control" name="certification_org[]" placeholder="e.g. Amazon Web Services">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Issue Date</label>
                                <input type="month" class="form-control" name="certification_date[]">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Credential URL</label>
                                <input type="url" class="form-control" name="credential_url[]" placeholder="https://...">
                            </div>
                        </div>
                    </div>
                </div>
                <button type="button" class="btn btn-outline-primary" id="addCertificationBtn">
                    <i class="fas fa-plus me-2"></i>Add Certification
                </button>
            </div>

            <div class="text-center">
                <button type="submit" class="btn btn-primary btn-lg">
                    <i class="fas fa-save me-2"></i>Save Resume
                </button>
            </div>
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            loadUserProfile();
            loadResumeData();
            
            document.getElementById('addExperienceBtn').addEventListener('click', addExperienceItem);
            document.getElementById('addEducationBtn').addEventListener('click', addEducationItem);
            document.getElementById('addProjectBtn').addEventListener('click', addProjectItem);
            document.getElementById('addCertificationBtn').addEventListener('click', addCertificationItem);
            
            document.getElementById('resumeForm').addEventListener('submit', saveResume);
            document.getElementById('saveResumeBtn').addEventListener('click', function() {
                document.getElementById('resumeForm').dispatchEvent(new Event('submit'));
            });
        });

        async function loadUserProfile() {
            try {
                const response = await fetch('handlers/profile_handler.php?action=get_profile');
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('navUserName').textContent = result.profile.first_name + ' ' + result.profile.last_name;
                }
            } catch (error) {
                console.error('Error loading profile:', error);
            }
        }

        async function loadResumeData() {
            try {
                const response = await fetch('handlers/profile_handler.php?action=get_profile');
                const result = await response.json();
                
                if (result.success && result.profile) {
                    const profile = result.profile;
                    
                    // Load summary
                    if (profile.bio) {
                        document.getElementById('summary').value = profile.bio;
                    }
                    
                    // Load skills
                    if (profile.skills) {
                        const skills = profile.skills.split(',');
                        const technical = skills.slice(0, Math.ceil(skills.length / 2)).join(', ');
                        const soft = skills.slice(Math.ceil(skills.length / 2)).join(', ');
                        
                        document.querySelector('textarea[name="technical_skills"]').value = technical;
                        document.querySelector('textarea[name="soft_skills"]').value = soft;
                    }
                    
                    // Load work experience
                    if (profile.work_experience && profile.work_experience.length > 0) {
                        loadWorkExperience(profile.work_experience);
                    }
                    
                    // Load education
                    if (profile.education && profile.education.length > 0) {
                        loadEducation(profile.education);
                    }
                }
            } catch (error) {
                console.error('Error loading resume data:', error);
            }
        }
        
        function loadWorkExperience(experiences) {
            const container = document.getElementById('experienceContainer');
            container.innerHTML = ''; // Clear existing
            
            experiences.forEach((exp, index) => {
                if (index === 0) {
                    // Update first item
                    const firstItem = createExperienceItem();
                    fillExperienceItem(firstItem, exp);
                    container.appendChild(firstItem);
                } else {
                    // Add new items
                    const newItem = createExperienceItem();
                    fillExperienceItem(newItem, exp);
                    container.appendChild(newItem);
                }
            });
            
            // If no experiences, add one empty item
            if (experiences.length === 0) {
                container.appendChild(createExperienceItem());
            }
        }
        
        function loadEducation(educationList) {
            const container = document.getElementById('educationContainer');
            container.innerHTML = ''; // Clear existing
            
            educationList.forEach((edu, index) => {
                if (index === 0) {
                    // Update first item
                    const firstItem = createEducationItem();
                    fillEducationItem(firstItem, edu);
                    container.appendChild(firstItem);
                } else {
                    // Add new items
                    const newItem = createEducationItem();
                    fillEducationItem(newItem, edu);
                    container.appendChild(newItem);
                }
            });
            
            // If no education, add one empty item
            if (educationList.length === 0) {
                container.appendChild(createEducationItem());
            }
        }
        
        function createExperienceItem() {
            const template = `
                <div class="experience-item">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Job Title</label>
                            <input type="text" class="form-control" name="job_title[]" placeholder="e.g. Software Engineer">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Company</label>
                            <input type="text" class="form-control" name="company[]" placeholder="e.g. Tech Company">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Start Date</label>
                            <input type="month" class="form-control" name="start_date[]">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">End Date</label>
                            <input type="month" class="form-control" name="end_date[]">
                            <div class="form-check mt-2">
                                <input class="form-check-input" type="checkbox" name="current_job[]">
                                <label class="form-check-label">Currently working here</label>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Job Description</label>
                        <textarea class="form-control" name="job_description[]" rows="3" 
                                  placeholder="Describe your responsibilities and achievements..."></textarea>
                    </div>
                </div>
            `;
            const div = document.createElement('div');
            div.innerHTML = template;
            return div.firstElementChild;
        }
        
        function createEducationItem() {
            const template = `
                <div class="education-item">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Degree</label>
                            <input type="text" class="form-control" name="degree[]" placeholder="e.g. Bachelor of Technology">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Institution</label>
                            <input type="text" class="form-control" name="institution[]" placeholder="e.g. University Name">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Year of Graduation</label>
                            <input type="number" class="form-control" name="graduation_year[]" min="1990" max="2030">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Grade/CGPA</label>
                            <input type="text" class="form-control" name="grade[]" placeholder="e.g. 8.5 CGPA">
                        </div>
                    </div>
                </div>
            `;
            const div = document.createElement('div');
            div.innerHTML = template;
            return div.firstElementChild;
        }
        
        function fillExperienceItem(item, data) {
            item.querySelector('input[name="job_title[]"]').value = data.jobTitle || '';
            item.querySelector('input[name="company[]"]').value = data.company || '';
            item.querySelector('input[name="start_date[]"]').value = data.startDate || '';
            
            if (data.endDate === 'Present') {
                item.querySelector('input[name="current_job[]"]').checked = true;
            } else {
                item.querySelector('input[name="end_date[]"]').value = data.endDate || '';
            }
            
            item.querySelector('textarea[name="job_description[]"]').value = data.description || '';
        }
        
        function fillEducationItem(item, data) {
            item.querySelector('input[name="degree[]"]').value = data.degree || '';
            item.querySelector('input[name="institution[]"]').value = data.institution || '';
            item.querySelector('input[name="graduation_year[]"]').value = data.year || '';
            item.querySelector('input[name="grade[]"]').value = data.grade || '';
        }

        function addExperienceItem() {
            const container = document.getElementById('experienceContainer');
            const newItem = createExperienceItem();
            container.appendChild(newItem);
        }

        function addEducationItem() {
            const container = document.getElementById('educationContainer');
            const newItem = createEducationItem();
            container.appendChild(newItem);
        }

        function addProjectItem() {
            const container = document.getElementById('projectsContainer');
            const newItem = container.querySelector('.project-item').cloneNode(true);
            
            newItem.querySelectorAll('input, textarea').forEach(input => {
                input.value = '';
            });
            
            container.appendChild(newItem);
        }

        function addCertificationItem() {
            const container = document.getElementById('certificationsContainer');
            const newItem = container.querySelector('.certification-item').cloneNode(true);
            
            newItem.querySelectorAll('input').forEach(input => {
                input.value = '';
            });
            
            container.appendChild(newItem);
        }

        async function saveResume(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            
            const experienceData = collectExperienceData();
            const educationData = collectEducationData();
            const projectsData = collectProjectsData();
            const certificationsData = collectCertificationsData();
            
            formData.append('work_experience', JSON.stringify(experienceData));
            formData.append('education', JSON.stringify(educationData));
            formData.append('projects', JSON.stringify(projectsData));
            formData.append('certifications', JSON.stringify(certificationsData));
            
            const technicalSkills = formData.get('technical_skills');
            const softSkills = formData.get('soft_skills');
            const allSkills = [technicalSkills, softSkills].filter(s => s).join(', ');
            formData.append('skills', allSkills);
            
            try {
                const response = await fetch('handlers/profile_handler.php', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage('Resume saved successfully!', 'success');
                } else {
                    showMessage(result.message, 'error');
                }
            } catch (error) {
                showMessage('Error saving resume', 'error');
            }
        }

        function collectExperienceData() {
            const experiences = [];
            document.querySelectorAll('.experience-item').forEach(item => {
                const jobTitle = item.querySelector('input[name="job_title[]"]').value;
                const company = item.querySelector('input[name="company[]"]').value;
                const startDate = item.querySelector('input[name="start_date[]"]').value;
                const endDate = item.querySelector('input[name="end_date[]"]').value;
                const currentJob = item.querySelector('input[name="current_job[]"]').checked;
                const description = item.querySelector('textarea[name="job_description[]"]').value;
                
                if (jobTitle || company) {
                    experiences.push({
                        jobTitle, company, startDate, endDate: currentJob ? 'Present' : endDate, description
                    });
                }
            });
            return experiences;
        }

        function collectEducationData() {
            const education = [];
            document.querySelectorAll('.education-item').forEach(item => {
                const degree = item.querySelector('input[name="degree[]"]').value;
                const institution = item.querySelector('input[name="institution[]"]').value;
                const year = item.querySelector('input[name="graduation_year[]"]').value;
                const grade = item.querySelector('input[name="grade[]"]').value;
                
                if (degree || institution) {
                    education.push({ degree, institution, year, grade });
                }
            });
            return education;
        }

        function collectProjectsData() {
            const projects = [];
            document.querySelectorAll('.project-item').forEach(item => {
                const name = item.querySelector('input[name="project_name[]"]').value;
                const url = item.querySelector('input[name="project_url[]"]').value;
                const description = item.querySelector('textarea[name="project_description[]"]').value;
                
                if (name) {
                    projects.push({ name, url, description });
                }
            });
            return projects;
        }

        function collectCertificationsData() {
            const certifications = [];
            document.querySelectorAll('.certification-item').forEach(item => {
                const name = item.querySelector('input[name="certification_name[]"]').value;
                const org = item.querySelector('input[name="certification_org[]"]').value;
                const date = item.querySelector('input[name="certification_date[]"]').value;
                const url = item.querySelector('input[name="credential_url[]"]').value;
                
                if (name) {
                    certifications.push({ name, org, date, url });
                }
            });
            return certifications;
        }

        function showMessage(message, type) {
            const alertClass = type === 'success' ? 'alert-success' : 'alert-danger';
            const alertHtml = `
                <div class="alert ${alertClass} alert-dismissible fade show position-fixed" 
                     style="top: 20px; right: 20px; z-index: 9999; min-width: 300px;">
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', alertHtml);
        }
    </script>
</body>
</html>